{"version":3,"sources":["src/firestore/platform_node/node_platform.ts","firestore/platform_node/node_platform.js"],"names":["NodePlatform","base64Available","emptyByteString","Uint8Array","prototype","loadConnection","databaseInfo","then","protos","newSerializer","partitionId","useProto3Json","atob","encoded","test","INVALID_ARGUMENT","Buffer","toString","btoa","raw"],"mappings":";;;;;;;AAmBA;;AACA;;AAEA;;AACA;;AAvBA;;;;;;;;;;;;;;;AAyBA,IAAAA,eAAA,aAAA,YAAA;AAAA,aAAAA,YAAA,GAAA;AACW,aAAAC,eAAA,GAAkB,IAAlB;AAEA,aAAAC,eAAA,GAAkB,IAAIC,UAAJ,CAAe,CAAf,CAAlB;AA2BV;AAzBCH,iBAAAI,SAAA,CAAAC,cAAA,GAAA,UAAeC,YAAf,EAAyC;AACvC,eAAO,oCAAkBC,IAAlB,CAAuB,UAAAC,MAAA,EAAM;AAClC,mBAAO,oCAAmBA,MAAnB,EAA2BF,YAA3B,CAAP;AACD,SAFM,CAAP;AAGD,KAJD;AAMAN,iBAAAI,SAAA,CAAAK,aAAA,GAAA,UAAcC,WAAd,EAAqC;AACnC,eAAO,oCAAwBA,WAAxB,EAAqC,EAAEC,eAAe,KAAjB,EAArC,CAAP;AACD,KAFD;AAIAX,iBAAAI,SAAA,CAAAQ,IAAA,GAAA,UAAKC,OAAL,EAAoB;AAClB;AACA;AACA,YAAI,mBAAmBC,IAAnB,CAAwBD,OAAxB,CAAJ,EAAsC;AACpC,kBAAM,0BACJ,YAAKE,gBADD,EAEJ,gCAAgCF,OAF5B,CAAN;AAID;AACD,eAAO,IAAIG,MAAJ,CAAWH,OAAX,EAAoB,QAApB,EAA8BI,QAA9B,CAAuC,QAAvC,CAAP;AACD,KAVD;AAYAjB,iBAAAI,SAAA,CAAAc,IAAA,GAAA,UAAKC,GAAL,EAAgB;AACd,eAAO,IAAIH,MAAJ,CAAWG,GAAX,EAAgB,QAAhB,EAA0BF,QAA1B,CAAmC,QAAnC,CAAP;AACD,KAFD;AAGF,WAAAjB,YAAA;AA9BA,CAAA,EAAA;QCoBSA,Y,GAAAA,Y","file":"node_platform.js","sourcesContent":["/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DatabaseId, DatabaseInfo } from '../core/database_info';\nimport { Platform } from '../platform/platform';\nimport { Connection } from '../remote/connection';\nimport { JsonProtoSerializer } from '../remote/serializer';\nimport { Code, FirestoreError } from '../util/error';\n\nimport { GrpcConnection } from './grpc_connection';\nimport { loadProtosAsync } from './load_protos';\n\nexport class NodePlatform implements Platform {\n  readonly base64Available = true;\n\n  readonly emptyByteString = new Uint8Array(0);\n\n  loadConnection(databaseInfo: DatabaseInfo): Promise<Connection> {\n    return loadProtosAsync().then(protos => {\n      return new GrpcConnection(protos, databaseInfo);\n    });\n  }\n\n  newSerializer(partitionId: DatabaseId): JsonProtoSerializer {\n    return new JsonProtoSerializer(partitionId, { useProto3Json: false });\n  }\n\n  atob(encoded: string): string {\n    // Node actually doesn't validate base64 strings.\n    // A quick sanity check that is not a fool-proof validation\n    if (/[^-A-Za-z0-9+/=]/.test(encoded)) {\n      throw new FirestoreError(\n        Code.INVALID_ARGUMENT,\n        'Not a valid Base64 string: ' + encoded\n      );\n    }\n    return new Buffer(encoded, 'base64').toString('binary');\n  }\n\n  btoa(raw: string): string {\n    return new Buffer(raw, 'binary').toString('base64');\n  }\n}\n","/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { JsonProtoSerializer } from '../remote/serializer';\nimport { Code, FirestoreError } from '../util/error';\nimport { GrpcConnection } from './grpc_connection';\nimport { loadProtosAsync } from './load_protos';\nvar NodePlatform = /** @class */ (function () {\n    function NodePlatform() {\n        this.base64Available = true;\n        this.emptyByteString = new Uint8Array(0);\n    }\n    NodePlatform.prototype.loadConnection = function (databaseInfo) {\n        return loadProtosAsync().then(function (protos) {\n            return new GrpcConnection(protos, databaseInfo);\n        });\n    };\n    NodePlatform.prototype.newSerializer = function (partitionId) {\n        return new JsonProtoSerializer(partitionId, { useProto3Json: false });\n    };\n    NodePlatform.prototype.atob = function (encoded) {\n        // Node actually doesn't validate base64 strings.\n        // A quick sanity check that is not a fool-proof validation\n        if (/[^-A-Za-z0-9+/=]/.test(encoded)) {\n            throw new FirestoreError(Code.INVALID_ARGUMENT, 'Not a valid Base64 string: ' + encoded);\n        }\n        return new Buffer(encoded, 'base64').toString('binary');\n    };\n    NodePlatform.prototype.btoa = function (raw) {\n        return new Buffer(raw, 'binary').toString('base64');\n    };\n    return NodePlatform;\n}());\nexport { NodePlatform };\n\n\n"]}